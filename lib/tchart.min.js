(function(){var t,s,i,n={}.hasOwnProperty;t=function(){function t(t){this.segments=[],this.style=t}return t.prototype.draw=function(t,s,i,n){return this.segments.push([t,s,i,n])},t.prototype.connectSegments=function(){var t,s,i,n,e,r,h,o,g,a,c,l,u,f,p;for(g=this.segments,t=0,i=g.length;i>t;t++)for(f=g[t],f[4]=null,f[5]=null,a=this.segments,s=0,n=a.length;n>s;s++)if(p=a[s],f[2]===p[0]&&f[3]===p[1]){f[4]=p,p[5]=f;break}for(c=this.segments,u=[],h=0,e=c.length;e>h;h++){if(f=c[h],f[4]&&!f[4][4])for(l=this.segiments,o=0,r=l.length;r>o;o++)if(p=l[o],f[2]===p[0]&&f[3]===p[1]&&p[4]&&!p[5]){f[4][5]=null,f[4]=p,p[5]=f;break}f[5]&&!f[5][5]?u.push(function(){var t,s,i,n;for(i=this.segiments,n=[],s=0,t=i.length;t>s;s++){if(p=i[s],p[2]===f[0]&&p[3]===f[1]&&p[5]&&!p[4]){f[5][4]=null,f[5]=p,p[4]=f;break}n.push(void 0)}return n}.call(this)):u.push(void 0)}return u},t.prototype.svg=function(){var t,s,i,n,e,r,h,o;for(e=[],r=this.segments,i=0,n=r.length;n>i;i++)if(o=r[i],!o[5])for(h=o,t=h[0],s=h[1],e.push("M"+t+","+s);h;)t===h[2]&&s===h[3]||(t===h[2]?"V"===e[e.length-1][0]?e[e.length-1]="V"+h[3]:e.push("V"+h[3]):s===h[3]?"H"===e[e.length-1][0]?e[e.length-1]="H"+h[2]:e.push("H"+h[2]):e.push("L"+h[2]+","+h[3])),t=h[2],s=h[3],h=h[4];return"<path "+this.style+' d="'+e.join("")+'" />\n'},t}(),s=function(){function s(s,i){this.config=s,this.x=s.w_caption,this.y=i,this.path=new t(s.signal_style),this.current=0,this.crosses=[],this.strings=[],this.grids=[],this.highlights=[]}return s.transitions=["          ","  - 1 4 14","  2 ~ / ~/","  3 ` _ _`","  23`~/_= ","  23`~/_=/","  23`~/_=`","  23`~/_X ","  23`~/_=X"],s.transitionLines={" ":[],"~":[[1,1]],_:[[0,0]],"=":[[1,1],[0,0]],X:[[1,0],[0,1]],"`":[[1,0]],"/":[[0,1]],1:[[1,.5]],2:[[.5,1]],3:[[.5,0]],4:[[0,.5]],"-":[[.5,.5]]},s.stateLines=[[],[.5],[1],[0],[0,1]],s.codes=":-~_=/\\X*",s.prototype.ys=function(t){return this.y+(1-t)*this.config.h_line},s.prototype.y0=function(){return this.ys(0)},s.prototype.y1=function(){return this.ys(1)},s.prototype.yz=function(){return this.ys(.5)},s.prototype.xh=function(){return this.x+this.config.w_transient/2},s.prototype.xt=function(){return this.x+this.config.w_transient},s.prototype.xr=function(){return this.x+this.config.w_transient+this.config.w_hold},s.prototype.parse=function(t){for(var s,i;t.length>0;)(s=/^\s+/.exec(t))||((s=/^\|/.exec(t))?this.grids.push([this.xh(),this.config.grid_style]):(s=/^\[/.exec(t))?(0===this.highlights.length||Array.isArray(this.highlights[this.highlights.length-1]))&&this.highlights.push(this.xh()):(s=/^\]/.exec(t))?this.highlights.length>0&&!Array.isArray(this.highlights[this.highlights.length-1])&&(this.highlights[this.highlights.length-1]=[this.highlights[this.highlights.length-1],this.xh(),this.config.highlight_style]):(i=/^([:\-~_=\/\\X*])/.exec(t))?this.addState(i[1]):(i=/^"(([^"]|"")*)"/.exec(t))?this.addString(i[1].replace(/""/g,'"').replace(/\ /g,"&nbsp;")):(i=/^'(([^']|'')*)'/.exec(t))?this.addString(i[1].replace(/''/g,"'").replace(/\ /g,"&nbsp;")):(i=/([^:\-~_=\/\\X*\|\]\[]+)/.exec(t))&&this.addString(i[1])),t=t.substr(i[0].length,t.length-i[0].length);return this.processStrings()+this.path.svg()},s.prototype.addState=function(t){var i,n;return n=s.codes.indexOf(t),i=this.drawTransition(n),n>4&&(n=4),this.drawState(n),""!==i&&this.crosses.push([this.x,i]),(0===this.current&&0!==n||0!==this.current&&0===n||0===this.crosses.length&&0===n)&&this.crosses.push([this.x,"|"]),this.current=n,this.x=this.xr()},s.prototype.addString=function(t){return this.strings.push([this.crosses.length,t.replace(/^\s+|\s+$/g,"")])},s.prototype.drawTransition=function(t){var i,n,e,r,h;for(i="",h=s.transitions[t].substr(2*this.current,2),n=e=0,r=h.length-1;r>=0?r>=e:e>=r;n=r>=0?++e:--e)i+=this.drawTransitionSub(h[n]);return i},s.prototype.drawTransitionSub=function(t){var i,n,e,r,h;for(i="",h=s.transitionLines[t],n=0,e=h.length;e>n;n++)r=h[n],this.path.draw(this.x,this.ys(r[0]),this.xt(),this.ys(r[1])),r[0]!==r[1]&&(i+=t);return i},s.prototype.drawState=function(t){var i,n,e,r,h;for(r=s.stateLines[t],h=[],i=0,n=r.length;n>i;i++)e=r[i],h.push(this.path.draw(this.xt(),this.ys(e),this.xr(),this.ys(e)));return h},s.prototype.processStrings=function(){var t,s,i,n,e,r,h,o,g,a,c,l,u,f,p,y,d,x,_,w;for(o=[],this.crosses.push([this.x,"|"]),e=this.strings,s=0,i=e.length;i>s;s++)h=e[s],x=this.ys(0),_=this.ys(1),w=this.ys(.5),a=this.crosses[h[0]-1][0],u=a+this.config.w_transient,c=a+this.config.w_transient/2,l=u+this.config.w_hold,f=this.crosses[h[0]][0],d=f+this.config.w_transient,p=f+this.config.w_transient/2,y=d+this.config.w_hold,"?"===h[1]&&(n=["M"+u+","+_+"H"+f],n.push(function(){switch(this.crosses[h[0]][1]){case"|":return"";case"XX":return"L"+p+","+w;case"/":return"H"+d;case"`":return"L"+d+","+x;case"23":return"H"+d+"L"+f+","+w+"L"+d+","+x;case"14":return"L"+d+","+w;case"1":return"L"+d+","+w+"V"+x;case"2":return"H"+d+"L"+f+","+w;case"3":return"V"+w+"L"+d+","+x;case"4":return"H"+d+"V"+w}}.call(this)),n.push("L"+f+","+x+"H"+u),n.push(function(){switch(this.crosses[h[0]-1][1]){case"|":return"";case"XX":return"L"+c+","+w;case"/":return"H"+a;case"`":return"L"+a+","+_;case"23":return"L"+a+","+w;case"14":return"H"+a+"L"+u+","+w+"L"+a+","+_;case"1":return"V"+w+"L"+a+","+_;case"2":return"H"+a+"V"+w;case"3":return"L"+a+","+w+"V{y1}";case"4":return"H"+a+"L"+xt+","+w}}.call(this)),n.push("Z"),o.push('\n<path stroke="none" d="'+n.join("")+'" '+this.config.notcare_style+"/>")),r=h[1].replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),"_<_"===h[1].substr(0,3)?(g=u,t="start",r=r.substring(6)):"_>_"===h[1].substr(0,3)?(g=f,t="end",r=r.substring(6)):(g=(c+p)/2,t="middle"),o.push('<text x="'+g+'" y="'+(this.ys(0)-1.5)+'" text-anchor="'+t+'" '+('font-size="'+this.config.h_line+'" '+this.config.signal_font+">"+r+"</text>\n"));return o.join("")},s}(),i=function(){function t(s){null==s&&(s={}),this.config={},this.setConfig(t.config),this.setConfig(s)}return t.config={scale:1,margin:10,w_caption:40,w_hold:10,w_transient:2,h_line:10,h_space:10,signal_style:'stroke-linecap="round" stroke-width="0.6" stroke="black" fill="none"',grid_style:'stroke-linecap="round" stroke-width="0.6" stroke="red" fill="none"',highlight_style:'stroke="none" fill="#ff8"',notcare_style:'fill="#ccc"',rotate:0,caption_font:'fill="black" font-family="Helvetica"',signal_font:'fill="black" font-family="Helvetica"'},t.format=function(s,i){return null==i&&(i={}),new t(i).parse(s)},t.prototype.setConfig=function(t){var s,i,e;i=[];for(s in t)n.call(t,s)&&(e=t[s],i.push(this.config[s]=e));return i},t.prototype.parse=function(t){var s,i,n,e;for(this.svg=[],this.grids=[],this.highlights=[],this.y=-1,this.x_max=this.config.w_caption,t=t.replace(/^\n+/,""),t=t.replace(/\n+$/,""),e=t.split("\n"),s=0,i=e.length;i>s;s++)n=e[s],this.parseLine(n);return this.processGrids(),this.processHighlights(),this.formatSVG(t)},t.prototype.formatSVG=function(t){var s,i,n;return i=this.config.margin,n=(this.x_max+2*i)*this.config.scale*1.3,s=(this.y+2*i)*this.config.scale*1.3,this.width=n,this.height=s,this.svg='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n  width="'+n+'px" height="'+s+'px" viewBox="'+-i+" "+-i+" "+(this.x_max+2*i)+" "+(this.y+2*i)+'" version="1.1">\n<![CDATA[\n'+t.replace(/\]\]\>/g,"]]&gt;")+"\n]]>\n<g>\n"+this.svg.join("\n")+"\n</g>\n</svg>"},t.prototype.parseLine=function(t){var s,i;if("#"!==t[0]){if(s=function(t){var s;return s=typeof t,("number"===s||"string"===s)&&!isNaN(t-parseFloat(t))},"@"===t[0]){if(!(i=/^@([^\s]+)[\s]+([^\s].*)$/.exec(t)))throw new SyntaxError("Illegal Line: "+t);return void(s(this.config[i[1]])?this.config[i[1]]=Number(i[2]):this.config[i[1]]=i[2])}if("%"===t[0]){if(!(i=/^%(-?[\d\.]+)\s+(-?[\d\.]+)\s+?(.*)$/.exec(t)))throw new SyntaxError("Illegal Line: "+t);return void this.svg.push('<text x="'+i[1]+'" y="'+i[2]+'" text-anchor="middle" '+('font-size="'+this.config.h_line+'" '+this.config.signal_font+">"+i[3]+"</text>"))}if(this.y<0?this.y=0:this.y+=this.config.h_space,t=t.replace(/\s*$/,""),""!==t){if(!(i=/^([^\s]+)[\s]+([^\s].*)$/.exec(t)))throw new SyntaxError("Illegal Line: "+t);return this.formatCaption(i[1]),this.formatTimeline(i[2]),this.y+=this.config.h_line}}},t.prototype.formatCaption=function(t){var s;return s=t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),this.svg.push('<text x="'+(this.config.w_caption-5)+'" y="'+(this.y+this.config.h_line-1.5)+'" text-anchor="end" '+('font-size="'+this.config.h_line+'" '+this.config.caption_font+">"+s+"</text>"))},t.prototype.formatTimeline=function(t){var i,n,e,r,h,o,g,a,c,l;for(l=new s(this.config,this.y),this.svg.push(l.parse(t)),l.x>this.x_max&&(this.x_max=l.x),g=l.grids,e=0,h=g.length;h>e;e++)i=g[e],this.grids.push(i);for(a=l.highlights,c=[],r=0,o=a.length;o>r;r++)n=a[r],c.push(this.highlights.push(n));return c},t.prototype.processGrids=function(){var t,s,i,n,e,r,h;for(h=-this.config.margin/2,t=this.y+this.config.margin/2,e=this.grids,r=[],i=0,n=e.length;n>i;i++)s=e[i],r.push(this.svg.push('<path d="M'+s[0]+","+h+"V"+t+'" '+s[1]+" />"));return r},t.prototype.processHighlights=function(){var t,s,i,n,e,r,h;for(h=-this.config.margin/2,t=this.y+this.config.margin/2,e=this.highlights,r=[],i=0,n=e.length;n>i;i++)s=e[i],Array.isArray(s)?r.push(this.svg.unshift('<path d="M'+s[0]+","+h+"V"+t+"H"+s[1]+"V"+h+'Z" '+s[2]+" />")):r.push(void 0);return r},t}(),null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=i:this.TimingChart=i}).call(this);
//# sourceMappingURL=tchart.min.js.map