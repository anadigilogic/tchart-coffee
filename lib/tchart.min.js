(function(){"use strict";var t,i,s,n,e={}.hasOwnProperty;t=function(){function t(t){this.segments=[],this.style=t}return t.prototype.draw=function(t,i,s,n){return this.segments.push([t,i,s,n])},t.prototype.connectSegments=function(){var t,i,s,n,e,r,h,o,g,c,a,l,u,f,p;for(g=this.segments,t=0,s=g.length;s>t;t++)for(f=g[t],f[4]=null,f[5]=null,c=this.segments,i=0,n=c.length;n>i;i++)if(p=c[i],f[2]===p[0]&&f[3]===p[1]){f[4]=p,p[5]=f;break}for(a=this.segments,u=[],h=0,e=a.length;e>h;h++){if(f=a[h],f[4]&&!f[4][4])for(l=this.segiments,o=0,r=l.length;r>o;o++)if(p=l[o],f[2]===p[0]&&f[3]===p[1]&&p[4]&&!p[5]){f[4][5]=null,f[4]=p,p[5]=f;break}f[5]&&!f[5][5]?u.push(function(){var t,i,s,n;for(s=this.segiments,n=[],i=0,t=s.length;t>i;i++){if(p=s[i],p[2]===f[0]&&p[3]===f[1]&&p[5]&&!p[4]){f[5][4]=null,f[5]=p,p[4]=f;break}n.push(void 0)}return n}.call(this)):u.push(void 0)}return u},t.prototype.svg=function(){var t,i,s,n,e,r,h,o;for(e=[],r=this.segments,s=0,n=r.length;n>s;s++)if(o=r[s],!o[5])for(h=o,t=h[0],i=h[1],e.push("M"+t+","+i);h;)t===h[2]&&i===h[3]||(t===h[2]?"V"===e[e.length-1][0]?e[e.length-1]="V"+h[3]:e.push("V"+h[3]):i===h[3]?"H"===e[e.length-1][0]?e[e.length-1]="H"+h[2]:e.push("H"+h[2]):e.push("L"+h[2]+","+h[3])),t=h[2],i=h[3],h=h[4];return"<path "+this.style+' d="'+e.join("")+'" />\n'},t}(),i=function(){function i(i,s){this.config=i,this.x=i.w_caption,this.y=s,this.path=new t(i.signal_style),this.current=0,this.crosses=[],this.strings=[],this.guides=[],this.highlights=[]}return i.transitions=["          ","  - 1 4 14","  2 ~ / ~/","  3 ` _ _`","  23`~/_= ","  23`~/_=/","  23`~/_=`","  23`~/_X ","  23`~/_=X"],i.transitionLines={" ":[],"~":[[1,1]],_:[[0,0]],"=":[[1,1],[0,0]],X:[[1,0],[0,1]],"`":[[1,0]],"/":[[0,1]],1:[[1,.5]],2:[[.5,1]],3:[[.5,0]],4:[[0,.5]],"-":[[.5,.5]]},i.stateLines=[[],[.5],[1],[0],[0,1]],i.codes=":-~_=/\\X*",i.prototype.ys=function(t){return this.y+(1-t)*this.config.h_line},i.prototype.y0=function(){return this.ys(0)},i.prototype.y1=function(){return this.ys(1)},i.prototype.yz=function(){return this.ys(.5)},i.prototype.xh=function(){return this.x+this.config.w_transient/2},i.prototype.xt=function(){return this.x+this.config.w_transient},i.prototype.xr=function(){return this.x+this.config.w_transient+this.config.w_hold},i.prototype.parse=function(t){for(var i,s;t.length>0;)(i=/^\s+/.exec(t))||((i=/^\|/.exec(t))?this.guides.push([this.xh(),this.config.guide_style]):(i=/^\[/.exec(t))?(0===this.highlights.length||Array.isArray(this.highlights[this.highlights.length-1]))&&this.highlights.push(this.xh()):(i=/^\]/.exec(t))?this.highlights.length>0&&!Array.isArray(this.highlights[this.highlights.length-1])&&(this.highlights[this.highlights.length-1]=[this.highlights[this.highlights.length-1],this.xh(),this.config.highlight_style]):(s=/^([:\-~_=\/\\X*])/.exec(t))?this.addState(s[1]):(s=/^"(([^"]|"")*)"/.exec(t))?this.addString(s[1].replace(/""/g,'"').replace(/\ /g,"&nbsp;")):(s=/^'(([^']|'')*)'/.exec(t))?this.addString(s[1].replace(/''/g,"'").replace(/\ /g,"&nbsp;")):(s=/([^:\-~_=\/\\X*\|\]\[]+)/.exec(t))&&this.addString(s[1])),t=t.substr(s[0].length,t.length-s[0].length);return this.processStrings()+this.path.svg()},i.prototype.addState=function(t){var s,n;return n=i.codes.indexOf(t),s=this.drawTransition(n),n>4&&(n=4),this.drawState(n),""!==s&&this.crosses.push([this.x,s]),(0===this.current&&0!==n||0!==this.current&&0===n||0===this.crosses.length&&0===n)&&this.crosses.push([this.x,"|"]),this.current=n,this.x=this.xr()},i.prototype.addString=function(t){return this.strings.push([this.crosses.length,t.replace(/^\s+|\s+$/g,"")])},i.prototype.drawTransition=function(t){var s,n,e,r,h;for(s="",h=i.transitions[t].substr(2*this.current,2),n=e=0,r=h.length-1;r>=0?r>=e:e>=r;n=r>=0?++e:--e)s+=this.drawTransitionSub(h[n]);return s},i.prototype.drawTransitionSub=function(t){var s,n,e,r,h;for(s="",h=i.transitionLines[t],n=0,e=h.length;e>n;n++)r=h[n],this.path.draw(this.x,this.ys(r[0]),this.xt(),this.ys(r[1])),r[0]!==r[1]&&(s+=t);return s},i.prototype.drawState=function(t){var s,n,e,r,h;for(r=i.stateLines[t],h=[],s=0,n=r.length;n>s;s++)e=r[s],h.push(this.path.draw(this.xt(),this.ys(e),this.xr(),this.ys(e)));return h},i.prototype.processStrings=function(){var t,i,s,n,e,r,h,o,g,c,a,l,u,f,p,d,y,x,_,w;for(o=[],this.crosses.push([this.x,"|"]),e=this.strings,i=0,s=e.length;s>i;i++)h=e[i],x=this.ys(0),_=this.ys(1),w=this.ys(.5),c=this.crosses[h[0]-1][0],u=c+this.config.w_transient,a=c+this.config.w_transient/2,l=u+this.config.w_hold,f=this.crosses[h[0]][0],y=f+this.config.w_transient,p=f+this.config.w_transient/2,d=y+this.config.w_hold,"?"===h[1]&&(n=["M"+u+","+_+"H"+f],n.push(function(){switch(this.crosses[h[0]][1]){case"|":return"";case"XX":return"L"+p+","+w;case"/":return"H"+y;case"`":return"L"+y+","+x;case"23":return"H"+y+"L"+f+","+w+"L"+y+","+x;case"14":return"L"+y+","+w;case"1":return"L"+y+","+w+"V"+x;case"2":return"H"+y+"L"+f+","+w;case"3":return"V"+w+"L"+y+","+x;case"4":return"H"+y+"V"+w}}.call(this)),n.push("L"+f+","+x+"H"+u),n.push(function(){switch(this.crosses[h[0]-1][1]){case"|":return"";case"XX":return"L"+a+","+w;case"/":return"H"+c;case"`":return"L"+c+","+_;case"23":return"L"+c+","+w;case"14":return"H"+c+"L"+u+","+w+"L"+c+","+_;case"1":return"V"+w+"L"+c+","+_;case"2":return"H"+c+"V"+w;case"3":return"L"+c+","+w+"V{y1}";case"4":return"H"+c+"L"+xt+","+w}}.call(this)),n.push("Z"),o.push('\n<path stroke="none" d="'+n.join("")+'" '+this.config.notcare_style+"/>")),r=h[1].replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),"_<_"===h[1].substr(0,3)?(g=u,t="start",r=r.substring(6)):"_>_"===h[1].substr(0,3)?(g=f,t="end",r=r.substring(6)):(g=(a+p)/2,t="middle"),o.push('<text x="'+g+'" y="'+(this.ys(0)-1.5)+'" text-anchor="'+t+'" '+('font-size="'+this.config.h_line+'" '+this.config.signal_font+">"+r+"</text>\n"));return o.join("")},i}(),n=function(t){var i;return i=typeof t,("number"===i||"string"===i)&&!isNaN(t-parseFloat(t))},s=function(){function t(i){null==i&&(i={}),this.config={},this.setConfig(t.config),this.setConfig(i)}return t.config={scale:1,margin:10,w_caption:40,w_hold:10,w_transient:2,h_line:10,h_space:10,signal_style:'stroke-linecap="round" stroke-width="0.6" stroke="black" fill="none"',guide_style:'stroke-width="0.6" stroke="red"',highlight_style:'stroke="none" fill="#ff8"',notcare_style:'fill="#ccc"',rotate:0,caption_font:'fill="black" font-family="Helvetica"',signal_font:'fill="black" font-family="Helvetica"',grid:"off",grid_style:'stroke-width="0.3" stroke="#ccc"',grid_step:1,grid_offset:0},t.format=function(i,s){return null==s&&(s={}),new t(s).parse(i)},t.prototype.setConfig=function(t){var i,s,n;s=[];for(i in t)e.call(t,i)&&(n=t[i],s.push(this.config[i]=n));return s},t.prototype.setupGrid=function(){return this.grid=[this.config.w_caption+this.config.w_transient/2,this.config.w_hold+this.config.w_transient]},t.prototype.parse=function(t){var i,s,n,e;for(this.svg=[],this.guides=[],this.highlights=[],this.y=-1,this.x_max=this.config.w_caption,t=t.replace(/^\n+/,""),t=t.replace(/\n+$/,""),"on"===this.config.grid&&this.setupGrid(),e=t.split("\n"),i=0,s=e.length;s>i;i++)n=e[i],this.parseLine(n);return this.processGrid(),this.processGuides(),this.processHighlights(),this.formatSVG(t)},t.prototype.formatSVG=function(t){var i,s,n;return s=this.config.margin,n=(this.x_max+2*s)*this.config.scale*1.3,i=(this.y+2*s)*this.config.scale*1.3,this.width=n,this.height=i,this.svg='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n  width="'+n+'px" height="'+i+'px" viewBox="'+-s+" "+-s+" "+(this.x_max+2*s)+" "+(this.y+2*s)+'" version="1.1">\n<![CDATA[\n'+t.replace(/\]\]\>/g,"]]&gt;")+"\n]]>\n<g>\n"+this.svg.join("\n")+"\n</g>\n</svg>\n"},t.prototype.processConfiguration=function(t,i){if("grid"===t)if("on"===i)this.setupGrid();else{if("off"!==i)throw new SyntaxError("Illegal Line: "+line);this.grid=null}else n(this.config[t])?this.config[t]=Number(i):this.config[t]=i},t.prototype.parseLine=function(t){var i;if("#"!==t[0]){if("@"===t[0]){if(!(i=/^@([^\s]+)\s+([^\s].*?)\s*$/.exec(t)))throw new SyntaxError("Illegal Line: "+t);return void this.processConfiguration(i[1],i[2])}if("%"===t[0]){if(!(i=/^%(-?[\d\.]+)\s+(-?[\d\.]+)\s+?(.*)$/.exec(t)))throw new SyntaxError("Illegal Line: "+t);return void this.svg.push('<text x="'+i[1]+'" y="'+i[2]+'" text-anchor="middle" '+('font-size="'+this.config.h_line+'" '+this.config.signal_font+">"+i[3]+"</text>"))}if(this.y<0?this.y=0:this.y+=this.config.h_space,t=t.replace(/\s*$/,""),""!==t){if(i=/^"((?:[^"]|"")+)"\s+([^\s].*)$/.exec(t))this.formatCaption(i[1].replace(/""/,'"')),this.formatTimeline(i[2]);else if(i=/^'((?:[^']|'')+)'\s+([^\s].*)$/.exec(t))this.formatCaption(i[1].replace(/''/,"'")),this.formatTimeline(i[2]);else{if(!(i=/^([^\s]+)\s+([^\s].*)$/.exec(t)))throw new SyntaxError("Illegal Line: "+t);this.formatCaption(i[1]),this.formatTimeline(i[2])}return this.y+=this.config.h_line}}},t.prototype.formatCaption=function(t){var i;return i=t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),this.svg.push('<text x="'+(this.config.w_caption-5)+'" y="'+(this.y+this.config.h_line-1.5)+'" text-anchor="end" '+('font-size="'+this.config.h_line+'" '+this.config.caption_font+">"+i+"</text>"))},t.prototype.formatTimeline=function(t){var s,n,e,r,h,o,g,c,a,l;for(l=new i(this.config,this.y),this.svg.push(l.parse(t)),l.x>this.x_max&&(this.x_max=l.x),g=l.guides,e=0,h=g.length;h>e;e++)s=g[e],this.guides.push(s);for(c=l.highlights,a=[],r=0,o=c.length;o>r;r++)n=c[r],a.push(this.highlights.push(n));return a},t.prototype.processGrid=function(){var t,i,s,n;if(this.grid){for(s=-this.config.margin/2,t=this.y+this.config.margin/2,n=this.grid[0]+this.grid[1]*this.config.grid_offset,i=[];n<this.x_max;)this.svg.unshift('<path d="M'+n+","+s+"V"+t+'" '+this.config.grid_style+" />"),i.push(n+=this.grid[1]*this.config.grid_step);return i}},t.prototype.processGuides=function(){var t,i,s,n,e,r,h;for(h=-this.config.margin/2,t=this.y+this.config.margin/2,e=this.guides,r=[],s=0,n=e.length;n>s;s++)i=e[s],r.push(this.svg.push('<path d="M'+i[0]+","+h+"V"+t+'" '+i[1]+" />"));return r},t.prototype.processHighlights=function(){var t,i,s,n,e,r,h;for(h=-this.config.margin/2,t=this.y+this.config.margin/2,e=this.highlights,r=[],s=0,n=e.length;n>s;s++)i=e[s],Array.isArray(i)?r.push(this.svg.unshift('<path d="M'+i[0]+","+h+"V"+t+"H"+i[1]+"V"+h+'Z" '+i[2]+" />")):r.push(void 0);return r},t}(),null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=s:this.TimingChart=s}).call(this);
//# sourceMappingURL=tchart.min.js.map