(function(){var t,s,i,n={}.hasOwnProperty;t=function(){function t(t){this.segments=[],this.style=t}return t.prototype.draw=function(t,s,i,n){return this.segments.push([t,s,i,n])},t.prototype.svg=function(){var t,s,i,n,e,h,r,o,g,c,a,l,u,f,p,y,x,d,_,w,m,v,L,H,b,S,k;for(d=this.segments,i=0,e=d.length;e>i;i++)b=d[i],b[4]=0,b[5]=null;for(_=this.segments,n=0,h=_.length;h>n;n++)for(S=_[n],w=this.segments,l=0,r=w.length;r>l;l++)k=w[l],S[2]===k[0]&&S[3]===k[1]&&(S[4]+=1,k[4]+=1);for(m=this.segments,u=0,o=m.length;o>u;u++){for(S=m[u],v=this.segments,f=0,g=v.length;g>f;f++)if(k=v[f],!(k[4]<2||S[2]!==k[0]||S[3]!==k[1])){S[5]=k,k[4]=-1;break}if(!S[5])for(L=this.segments,y=0,c=L.length;c>y;y++)if(k=L[y],1===k[4]&&S[2]===k[0]&&S[3]===k[1]){S[5]=k,k[4]=-1;break}}for(p=[],H=this.segments,x=0,a=H.length;a>x;x++)if(S=H[x],!(S[4]<0))for(b=S,t=b[0],s=b[1],p.push("M"+t+","+s);b;)t===b[2]&&s===b[3]||(t===b[2]?"V"===p[p.length-1][0]?p[p.length-1]="V"+b[3]:p.push("V"+b[3]):s===b[3]?"H"===p[p.length-1][0]?p[p.length-1]="H"+b[2]:p.push("H"+b[2]):p.push("L"+b[2]+","+b[3])),t=b[2],s=b[3],b=b[5];return"<path "+this.style+' d="'+p.join("")+'" />\n'},t}(),s=function(){function s(s,i){this.config=s,this.x=s.w_caption,this.y=i,this.path=new t(s.signal_style),this.current=0,this.crosses=[],this.strings=[],this.grids=[],this.highlights=[]}return s.transitions=["          ","  - 1 4 14","  2 ~ / ~/","  3 ` _ _`","  23`~/_= ","  23`~/_=/","  23`~/_=`","  23`~/_X ","  23`~/_=X"],s.transitionLines={" ":[],"~":[[1,1]],_:[[0,0]],"=":[[1,1],[0,0]],X:[[1,0],[0,1]],"`":[[1,0]],"/":[[0,1]],1:[[1,.5]],2:[[.5,1]],3:[[.5,0]],4:[[0,.5]],"-":[[.5,.5]]},s.stateLines=[[],[.5],[1],[0],[0,1]],s.codes=":-~_=/\\X*",s.prototype.ys=function(t){return this.y+(1-t)*this.config.h_line},s.prototype.y0=function(){return this.y+this.config.h_line},s.prototype.y1=function(){return this.y},s.prototype.yz=function(){return this.y+this.config.h_line/2},s.prototype.xh=function(){return this.x+this.config.w_transient/2},s.prototype.xt=function(){return this.x+this.config.w_transient},s.prototype.xr=function(){return this.x+this.config.w_transient+this.config.w_hold},s.prototype.parse=function(t){for(var s,i;""!==t;)(s=/^\s+/.exec(t))||((s=/^\|/.exec(t))?this.grids.push([this.xh(),this.config.grid_style]):(s=/^\[/.exec(t))?(0===this.highlights.length||Array.isArray(this.highlights[this.highlights.length-1]))&&this.highlights.push(this.xh()):(s=/^\]/.exec(t))?this.highlights.length>0&&!Array.isArray(this.highlights[this.highlights.length-1])&&(this.highlights[this.highlights.length-1]=[this.highlights[this.highlights.length-1],this.xh(),this.config.highlight_style]):(i=/^([:\-~_=\/\\X*])/.exec(t))?this.addState(i[1]):(i=/^"(([^"]|"")*)"/.exec(t))?this.addString(i[1].replace(/""/g,'"').replace(/[ ]/g,"&nbsp;")):(i=/([^:\-~_=\/\\X*\|\]\[]+)/.exec(t))&&this.addString(i[1])),t=t.substr(i[0].length,t.length-i[0].length);return this.processStrings()+this.path.svg()},s.prototype.addState=function(t){var i,n;return n=s.codes.indexOf(t),i=this.drawTransition(n),n>4&&(n=4),this.drawState(n),""!==i&&this.crosses.push([this.x,i]),(0===this.current&&0!==n||0!==this.current&&0===n||0===this.crosses.length&&0===n)&&this.crosses.push([this.x,"|"]),this.current=n,this.x=this.xr()},s.prototype.addString=function(t){return this.strings.push([this.crosses.length,t.replace(/^\s+|\s+$/g,"")])},s.prototype.drawTransition=function(t){var i,n,e,h,r;for(i="",r=s.transitions[t].substr(2*this.current,2),n=e=0,h=r.length-1;h>=0?h>=e:e>=h;n=h>=0?++e:--e)i+=this.drawTransitionSub(r[n]);return i},s.prototype.drawTransitionSub=function(t){var i,n,e,h,r;for(i="",r=s.transitionLines[t],n=0,e=r.length;e>n;n++)h=r[n],this.path.draw(this.x,this.ys(h[0]),this.xt(),this.ys(h[1])),h[0]!==h[1]&&(i+=t);return i},s.prototype.drawState=function(t){var i,n,e,h,r;for(h=s.stateLines[t],r=[],i=0,n=h.length;n>i;i++)e=h[i],r.push(this.path.draw(this.xt(),this.ys(e),this.xr(),this.ys(e)));return r},s.prototype.processStrings=function(){var t,s,i,n,e,h,r,o,g,c,a,l,u,f,p,y,x,d,_,w;for(o=[],this.crosses.push([this.x,"|"]),e=this.strings,s=0,i=e.length;i>s;s++)r=e[s],d=this.ys(0),_=this.ys(1),w=this.ys(.5),c=this.crosses[r[0]-1][0],u=c+this.config.w_transient,a=c+this.config.w_transient/2,l=u+this.config.w_hold,f=this.crosses[r[0]][0],x=f+this.config.w_transient,p=f+this.config.w_transient/2,y=x+this.config.w_hold,"?"===r[1]&&(n=["M"+u+","+_+"H"+f],n.push(function(){switch(this.crosses[r[0]][1]){case"|":return"";case"XX":return"L"+p+","+w;case"/":return"H"+x;case"`":return"L"+x+","+d;case"23":return"H"+x+"L"+f+","+w+"L"+x+","+d;case"14":return"L"+x+","+w;case"1":return"L"+x+","+w+"V"+d;case"2":return"H"+x+"L"+f+","+w;case"3":return"V"+w+"L"+x+","+d;case"4":return"H"+x+"V"+w}}.call(this)),n.push("L"+f+","+d+"H"+u),n.push(function(){switch(this.crosses[r[0]-1][1]){case"|":return"";case"XX":return"L"+a+","+w;case"/":return"H"+c;case"`":return"L"+c+","+_;case"23":return"L"+c+","+w;case"14":return"H"+c+"L"+u+","+w+"L"+c+","+_;case"1":return"V"+w+"L"+c+","+_;case"2":return"H"+c+"V"+w;case"3":return"L"+c+","+w+"V{y1}";case"4":return"H"+c+"L"+xt+","+w}}.call(this)),n.push("Z"),o.push('\n<path stroke="none" d="'+n.join("")+'" '+this.config.notcare_style+"/>")),h=r[1].replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),"_<_"===r[1].substr(0,3)?(g=u,t="start",h=h.substring(6)):"_>_"===r[1].substr(0,3)?(g=f,t="end",h=h.substring(6)):(g=(a+p)/2,t="middle"),o.push('<text x="'+g+'" y="'+(this.ys(0)-1.5)+'" text-anchor="'+t+'" '+('font-size="'+this.config.h_line+'" '+this.config.signal_font+">"+h+"</text>\n"));return o.join("")},s}(),i=function(){function t(s){null==s&&(s={}),this.config={},this.setConfig(t.config),this.setConfig(s)}var i;return t.config={scale:1,margin:10,w_caption:40,w_hold:10,w_transient:2,h_line:10,h_space:10,signal_style:'stroke-linecap="round" stroke-width="0.6" stroke="black" fill="none"',grid_style:'stroke-linecap="round" stroke-width="0.6" stroke="red" fill="none"',highlight_style:'stroke="none" fill="#ff8"',notcare_style:'fill="#ccc"',rotate:0,caption_font:'fill="black" font-family="Helvetica"',signal_font:'fill="black" font-family="Helvetica"'},t.format=function(s,i){return null==i&&(i={}),new t(i).parse(s)},t.prototype.setConfig=function(t){var s,i,e;i=[];for(s in t)n.call(t,s)&&(e=t[s],i.push(this.config[s]=e));return i},t.prototype.parse=function(t){var s,i,n,e;for(this.svg=[],this.grids=[],this.highlights=[],this.y=-1,this.x_max=this.config.w_caption,t=t.replace(/^\n+/,""),t=t.replace(/\n+$/,""),e=t.split("\n"),s=0,i=e.length;i>s;s++)n=e[s],this.parseLine(n);return this.processGrids(),this.processHighlights(),this.formatSVG(t)},t.prototype.formatSVG=function(t){var s,i,n;return i=this.config.margin,n=(this.x_max+2*i)*this.config.scale*1.3,s=(this.y+2*i)*this.config.scale*1.3,this.width=n,this.height=s,this.svg='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n  width="'+n+'px" height="'+s+'px" viewBox="'+-i+" "+-i+" "+(this.x_max+2*i)+" "+(this.y+2*i)+'" version="1.1">\n<![CDATA[\n'+t.replace(/\]\]\>/g,"]]&gt;")+"\n]]>\n<g>\n"+this.svg.join("\n")+"\n</g>\n</svg>"},t.prototype.parseLine=function(t){"#"===t[0]},i=function(t){var s,n,e;if(e=typeof t,("number"===e||"string"===e)&&!isNaN(t-parseFloat(t)),"@"===s[0]){if(!(n=/^@([^\s]+)[\s]+([^\s].*)$/.exec(s)))throw new SyntaxError("Illegal Line: "+s);return void(i(this.config[n[1]])?this.config[n[1]]=Number(n[2]):this.config[n[1]]=n[2])}if("%"===s[0]){if(!(n=/^%(-?[\d\.]+)\s+(-?[\d\.]+)\s+?(.*)$/.exec(s)))throw new SyntaxError("Illegal Line: "+s);return void this.svg.push('<text x="'+n[1]+'" y="'+n[2]+'" text-anchor="middle" '+('font-size="'+this.config.h_line+'" '+this.config.signal_font+">"+n[3]+"</text>"))}if(this.y<0?this.y=0:this.y+=this.config.h_space,s=s.replace(/\s*$/,""),""!==s){if(!(n=/^([^\s]+)[\s]+([^\s].*)$/.exec(s)))throw new SyntaxError("Illegal Line: "+s);return this.formatCaption(n[1]),this.formatTimeline(n[2]),this.y+=this.config.h_line}},t.prototype.formatCaption=function(t){var s;return s=t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),this.svg.push('<text x="'+(this.config.w_caption-5)+'" y="'+(this.y+this.config.h_line-1.5)+'" text-anchor="end" '+('font-size="'+this.config.h_line+'" '+this.config.caption_font+">"+s+"</text>"))},t.prototype.formatTimeline=function(t){var i,n,e,h,r,o,g,c,a,l;for(l=new s(this.config,this.y),this.svg.push(l.parse(t)),l.x>this.x_max&&(this.x_max=l.x),g=l.grids,e=0,r=g.length;r>e;e++)i=g[e],this.grids.push(i);for(c=l.highlights,a=[],h=0,o=c.length;o>h;h++)n=c[h],a.push(this.highlights.push(n));return a},t.prototype.processGrids=function(){var t,s,i,n,e,h,r;for(r=-this.config.margin/2,t=this.y+this.config.margin/2,e=this.grids,h=[],i=0,n=e.length;n>i;i++)s=e[i],h.push(this.svg.push('<path d="M'+s[0]+","+r+"V"+t+'" '+s[1]+" />"));return h},t.prototype.processHighlights=function(){var t,s,i,n,e,h,r;for(r=-this.config.margin/2,t=this.y+this.config.margin/2,e=this.highlights,h=[],i=0,n=e.length;n>i;i++)s=e[i],Array.isArray(s)?h.push(this.svg.unshift('<path d="M'+s[0]+","+r+"V"+t+"H"+s[1]+"V"+r+'Z" '+s[2]+" />")):h.push(void 0);return h},t}(),null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=i:this.TimingChart=i}).call(this);
//# sourceMappingURL=tchart.min.js.map